{% extends 'dtr5app/base.html' %}

{% block title %}settings for /u/{{user.username}}{% endblock %}

{% block body_classes %}me{% endblock %}

{% block main %}

<article>
  <div class="card section-search" id="id_search">
    <h2>search settings</h2>
    <form class="item" method="POST" action="{% url 'me_search_page' %}">
      {% csrf_token %}
      <input type="hidden" name="next" value="{% url 'me_page' %}">
      <p style="text-align:center">
        <label>
          <select name="f_sex" size="1">
            <option value="">everybody</option>
            {% for sex in sex_choices %}
              {% if sex.0 > 0 %}
                <option{% if user.profile.f_sex == sex.0 %} selected{% endif %} value="{{sex.0}}">{{sex.1}}</option>
              {% endif %}
            {% endfor %}
          </select>
        </label>&nbsp;
        <label>
          <select name="f_distance" size="1">
            {% for x in DISTANCE %}
              <option{% if user.profile.f_distance == x.0 %} selected{% endif %} value="{{x.0}}">{{x.1}}</option>
            {% endfor %}
          </select>
        </label>&nbsp;
        <label class="submit">
          <input type="submit" value="search">
          <!-- <span class="help">
            find people subscribed to the same subreddits as you.
          </span> -->
        </label>
      </p>

      <section class="toggle-section">
        <label for="id_984hfhe">
          <h3>more search settings</h3>
        </label>
        <input id="id_984hfhe" type="checkbox">
        <div class="opts">
          <!--
          <section>
            <label class="item">
              <input type="checkbox" name="herefor_hide" value="1"{% if user.profile.herefor_hide == settings.HEREFOR_ONLY_FRIENDS %} checked{% endif %}>
              <span class="tx">show redditors here for friends only</span>
            </label>
            <label class="item">
              <input type="checkbox" name="herefor_hide" value="1"{% if user.profile.herefor_hide == settings.HEREFOR_ONLY_DATING %} checked{% endif %}>
              <span class="tx">show redditors here only for dating</span>
            </label>
          </section>
          -->
          <section>
            <label>
              <span><b>ignore</b> these subreddits:</span>&nbsp;
              <input type="text" name="f_ignore_sr_li" value="{{user.profile.f_ignore_sr_li|join:', '}}" maxlength="800" size="50" placeholder="AskReddit, news, Pics, Funny">
            </label>
            <p class="help">these subreddits will be treated as if you were <b>not</b> subscribed to them. <a href="#" id="id_auto_add_default_subs"></a></p>
          </section>

          <section>
            <label>
              <span><b>ignore</b> all subreddits larger than:</span>&nbsp;
              <input type="number" min="0" max="123456789" name="f_ignore_sr_max" value="{{user.profile.f_ignore_sr_max}}" maxlength="10" size="10" placeholder="5,000,000">&nbsp;
              <span>subscribers</span>
            </label>
            <p class="help">all subreddits larger than this will be treated as if you were <b>not</b> subscribed to them.</p>
          </section>
<!--
          <section>
            <label>
              <span><b>exclude</b> everybody subscribed to any of these subreddits:</span>
              <input type="text" name="f_exclude_sr_li" value="{{user.profile.f_exclude_sr_li|join:', '}}" maxlength="250" size="50" placeholder="shitredditsays, dragonsfuckingcars, sexyabortions, coontown">
            </label>
            <p class="help"><strong>use carefully!</strong> anybody subscribed to any of these subreddits will be <strong>removed</strong> from your search results!</p>
          </section>
-->
          <section>
            <span><b>age range</b>: between&nbsp;
            <input type="number" min="18" max="98" name="f_minage" value="{{user.profile.f_minage}}">&nbsp;and&nbsp;
            <input type="number" min="19" max="100" name="f_maxage" value="{{user.profile.f_maxage}}">&nbsp;
            years old</span>
          </section>
          <section>
            <span><b>pictures</b> in profiles:&nbsp;
            <label>
              <input type="radio" name="f_hide_no_pic" value="nope"{% if not user.profile.f_hide_no_pic %} checked{% endif %}>&nbsp;
              <span>find all profiles</span>
            </label>
            &nbsp;&middot;&nbsp;
            <label>
              <input type="radio" name="f_hide_no_pic" value="yep"{% if user.profile.f_hide_no_pic %} checked{% endif %}>&nbsp;
              <span>only profiles with pictures</span>
            </label>
          </section>
        </div>
      </section>
    </form>
  </div>

  <div class="card nopadd section-profile" id="id_profile">
    <h2>profile settings</h2>
    <form class="item manual" method="POST" action="{% url 'me_manual_page' %}">
      {% csrf_token %}

      <section class="herefor">
        <p class="key-col">I am here for:</p>
        <p class="val-col">
          {% for x in settings.HEREFOR %}
            <label class="item">
              <input type="radio" name="herefor" value="{{x.0}}"{% if user.profile.herefor == x.0 %} checked{% elif not user.profile.herefor and x.0 == settings.HEREFOR_FRIENDS_OR_DATING %} checked{% endif %}>
              <span class="tx">{{x.1}}</span>
            </label>
          {% endfor %}
        </p>
      </section>

      <section>
        <p class="key-col">my gender:</p>
        <p class="val-col">
          <label class="sex">
            <select name="sex" size="1">
              {% for sex in sex_choices %}
                <option {% if user.profile.sex == sex.0 %}selected{% endif %} value="{{sex.0}}">{{sex.1}}</option>
              {% endfor %}
            </select>
          </label>
        </p>
      </section>

      <section>
        <p class="key-col">my birthday:</p>
        <p class="val-col">
          <label class="dob">
            <input type="date" name="dob" placeholder="YYYY-MM-DD" maxlength="10" value="{{user.profile.dob|date:'c'}}">
          </label>
        </p>
        <span class="help">never publicly shown! only used to show your age and zodiacs.</span>
      </section>

      <section>
        <span class="key-col">looking for:</span>
        <div class="val-col lookingfor-list">
          <ul>
            {% for x in lookingfor_choices %}
              <li>
                <label>
                  <input {% if x.0 in user.profile.lookingfor %}checked{% endif %} type="checkbox" name="lookingfor" value="{{x.0}}"> {{x.1}}
                </label>
              </li>
            {% endfor %}
          </ul>
        </div>
      </section>

      <section>
        <label class="val-col submit">
          <input type="submit" value="submit">
        </label>
      </section>

    </form>
  </div>

  <div class="card nopadd section-geolocation" id="id_geolocation">
    <h2>update geolocation</h2>
    <form class="item" method="GET" action="{% url 'me_locate_page' %}" onsubmit="geoloc(this);return false;">
      {% csrf_token %}
      <input type="hidden" name="lat" value="">
      <input type="hidden" name="lng" value="">
      <section>
        <p>
          fuzzy my location by&nbsp;
          <select name="fuzzy">
            <option value="2"{% if user.profile.fuzzy == 2 %} selected{% endif %}>2 km / 1.25 miles</option>
            <option value="5"{% if user.profile.fuzzy == 5 %} selected{% endif %}>5 km / 3 miles</option>
            <option value="10"{% if user.profile.fuzzy == 10 %} selected{% endif %}>10 km / 6 miles</option>
            <option value="20"{% if user.profile.fuzzy == 20 %} selected{% endif %}>20 km / 12 miles</option>
            <option value="50"{% if user.profile.fuzzy == 50 %} selected{% endif %}>50 km / 31 miles</option>
            <option value="100"{% if user.profile.fuzzy == 100 %} selected{% endif %}>100 km / 62 miles</option>
          </select>
          <input type="submit" value="auto-locate">
        </p>
        <p>
          or <a href="{% url 'me_locate_page' %}">type in your geolocation manually</a>
        </p>
      </section>
      <section class="nopadd foot">
        <p>
          your location will randomly be fuzzied by the radius you select. fuzzying happens <u>in your browser</u>, so your real location is <u>never</u> uploaded anywhere. your current fuzzied location is: <a href="https://www.google.com/maps/@{{user.profile.lat}},{{user.profile.lng}},11z">lat={{user.profile.lat}} lng={{user.profile.lng}}</a>
        </p>
      </section>
    </form>
  </div>

  <div class="card nopadd section-srlist" id="id_srlist">
    <h2>update subreddits</h2>
    <section>
      <form method="POST" action="{% url 'me_update_page' %}">
        {% csrf_token %}
        <input type="submit" value="update">
      </form>
    </section>
    <section class="nopadd foot">
      <p>
        fetches the list of subreddits you are subscribed to from your reddit profile. last updated {{user.profile.updated}}
      </p>
    </section>
  </div>

  <div class="card nopadd section-pics" id="id_pics">
    <h2>pictures of <a href="{% url 'profile_page' username=user.username %}">{{user.username}}</a></h2>
    <section class="item pics-form">
      <form method="POST" action="{% url 'me_picture_page' %}">
        {% csrf_token %}
        <input type="text" name="pic_url" value="" placeholder="https://imgur.com/??????">
        <input type="submit" value="add picture">
        <span class="help">&nbsp;max. {{USER_MAX_PICS_COUNT}} pics</span>
      </form>
    </section>

    <section class="item pics-preview">
      {% for pic in request.user.profile.pics %}
      <div class="pic">
        <a href="{{pic.src}}"><img src="{{pic.url}}" alt=""></a>
        <form method="POST" action="{% url 'me_pic_del_page' %}">
          {% csrf_token %}
          <input type="hidden" name="pic_url" value="{{pic.url}}">
          <input type="submit" value="delete">
        </form>
      </div>
      {% endfor %}
    </section>

    <section class="nopadd toggle-section">
      <label for="id_hdkhfsk7w87e">
        <h3>set background picture</h3>
      </label>
      <input id="id_hdkhfsk7w87e" type="checkbox">
      <div class="opts">
        <section>
          <form method="POST" action="{% url 'me_picture_page' %}">
            {% csrf_token %}
            <input type="text" name="bg_url" value="" placeholder="https://imgur.com/??????">
            <input type="submit" value="add a background picture">
          </form>
        </section>
      </div>
    </section>
  </div>

  <div class="card section-about" id="id_about">
    <h2>about <a href="{% url 'profile_page' username=user.username %}">{{user.username}}</a></h2>
    <form class="item" method="POST" action="{% url 'me_manual_page' %}">
      {% csrf_token %}
      <textarea name="about" placeholder="write about yourself. or about your favorite subreddits. or about why you like pizza and bacon. or about that bird you saw that just escaped that cat last year.">{{user.profile.about}}</textarea>
      <p><input type="submit" value="submit"></p>
    </form>
  </div>

  <div class="card section-account" id="id_account">
    <h2>account settings</h2>
    <section>
      <form method="POST" action="{% url 'me_manual_page' %}">
        {% csrf_token %}
        <input type="hidden" name="next" value="#id_account">
        <label><input{% if user.profile.pref_distance_unit == 'km' %} checked{% endif %} type="radio" name="pref_distance_unit" value="km"> km</label> or
        <label><input{% if user.profile.pref_distance_unit == 'mi' %} checked{% endif %} type="radio" name="pref_distance_unit" value="mi"> miles</label>
        <input type="submit">
      </form>
    </section>
    <ul>
      <li>
        <a href="{% url 'me_flag_del_page' %}">delete all my upvotes and nopes</a>&nbsp;
        <span class="help"></span>
      </li>
      <li>
        <a href="{% url 'me_account_del_page' %}">delete account data</a>&nbsp;
        <span class="help">deletes most account data, all pictures, 'like' votes, profile content, etc.</span>
      </li>
    </ul>
  </div>
</article>
<script>

(function(){

  var elLnk = document.getElementById('id_auto_add_default_subs');
  var defaultSRs = 'announcements Art AskReddit askscience aww blog books creepy dataisbeautiful DIY Documentaries EarthPorn explainlikeimfive Fitness food funny Futurology gadgets gaming GetMotivated gifs history IAmA InternetIsBeautiful Jokes LifeProTips listentothis mildlyinteresting movies Music news nosleep nottheonion OldSchoolCool personalfinance philosophy photoshopbattles pics science Showerthoughts space sports television tifu todayilearned TwoXChromosomes UpliftingNews videos worldnews WritingPrompts';
  elLnk.innerHTML = 'add default subreddits';
  elLnk.addEventListener('click', function(e){
    e.preventDefault();
    var elInp = document.querySelector('input[name="f_ignore_sr_li"]');
    elInp.value = defaultSRs;
  }, false);
})();

</script>

{% endblock %}