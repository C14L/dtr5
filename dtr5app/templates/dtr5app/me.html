{% extends 'dtr5app/base.html' %}

{% block main %}
<aside id="sidebar">
  <form class="sr-list" method="POST" action="{% url 'me_favsr_page' %}">
    {% csrf_token %}
    <h2>Favorite subreddits</h2>
    {% if user.subs.all %}
    <p>Pick up to 10 subreddits as your favourites.</p>
    <p><input type="submit"></p>
    <ul class="sr-list">
      {% for row in user.subs.all %}
      <li>
        <label>
          <input{% if row.is_favorite %} checked{% endif %} type="checkbox" name="id_{{row.sr.id}}" value="1">
        </label>
        <a href="{% url 'sr_page' row.sr.display_name %}">/r/{{row.sr.display_name}}</a>
        <div class="status">
          {% if row.sr.over_18 %}
          <span class="nsfw-tag">NSFW</span>
          {% endif %}
          {% if 1 == 0 and row.user_is_contributor %}
          <span class="contrib-tag">contributor</span>
          {% endif %}
          {% if row.user_is_moderator %}
          <span class="mod-tag">moderator</span>
          {% endif %}
          {% if 1 == 0 and row.user_is_subscriber %}
          <span class="subscr-tag">subscriber</span>
          {% endif %}
          {% if row.user_is_banned %}
          <span class="banned-tag">banned</span>
          {% endif %}
          {% if row.user_is_muted %}
          <span class="muted-tag">muted</span>
          {% endif %}
        </div>
      </li>
      {% endfor %}
    </ul>
    <p><input type="submit"></p>
    {% else %}
    <p>No subreddits to show.</p>
    {% endif %}
  </form>

</aside>

<article>

  <div class="settings-btns">
    <p><a href="{% url 'me_search_page' %}">Search</a> settings</p>
    <div class="item">
      <form method="POST" action="{% url 'me_search_page' %}">
        {% csrf_token %}
        <input type="hidden" name="next" value="{% url 'me_page' %}">
        <label>
          <span>Find</span>
          <select name="f_sex" size="1">
            <option value="">everybody</option>
            {% for sex in sex_choices %}
              {% if sex.0 > 0 %}
                <option{% if user.profile.f_sex == sex.0 %} selected{% endif %} value="{{sex.0}}">{{sex.1}}</option>
              {% endif %}
            {% endfor %}
          </select>
        </label>
        <label>
          <select name="f_distance" size="1"><!-- in km -->
            <option{% if user.profile.f_distance == 20040 %} selected{% endif %}  value="20040">worldwide</option>
            <option{% if user.profile.f_distance == 300 %} selected{% endif %}  value="300">not too far</option>
            <option{% if user.profile.f_distance == 50 %} selected{% endif %}  value="50">in my area</option>
            <option{% if user.profile.f_distance == 15 %} selected{% endif %} value="15">near by</option>
          </select>
        </label>
        <label class="submit">
          <input type="submit" value="save">
          <a href="{% url 'me_search_page' %}">browse redditors</a>
        </label>
      </form>
    </div>
  </div>

  <div class="settings-btns">
    <p>Profile settings for <a href="{% url 'profile_page' username=user.username %}">{{user.username}}</a>, a Reddit user since {{user.profile.created}}</p>
    <form class="item manual" method="POST" action="{% url 'me_manual_page' %}">
      {% csrf_token %}
      <label class="sex">
        <span>Sex:</span>
        <select name="sex" size="1">
          {% for sex in sex_choices %}
          <option{% if user.profile.sex == sex.0 %} selected{% endif %} value="{{sex.0}}">{{sex.1}}</option>
          {% endfor %}
        </select>
      </label>
      <label class="dob">
        <span>Birthday:</span>
        <input type="date" name="dob" placeholder="YYYY-MM-DD" maxlength="10" value="{{user.profile.dob|date:'c'}}">
        <span class="help">Never shown! Only your age, Western zodiac, and Chinese zodiac are shown.</span>
      </label>
      <label class="submit">
        <input type="submit">
      </label>
    </form>
    <div class="item">
      <form method="GET" action="{% url 'me_locate_page' %}" onsubmit="geoloc(this);return false;">
        {% csrf_token %}
        <input type="hidden" name="lat" value="">
        <input type="hidden" name="lng" value="">
        <input type="submit" value="locate">
      </form>
      <span>Update your geolocation, currently <a href="https://www.google.com/maps/@{{user.profile.lat}},{{user.profile.lng}},11z">lat={{user.profile.lat}} lng={{user.profile.lng}}</a></span>
      <span class="help">Your geolocation will randomly be fuzzied around a 1 km radius.</span>
    </div>
    <div class="item">
      <form method="POST" action="{% url 'me_update_page' %}">
        {% csrf_token %}
        <input type="submit" value="update">
      </form>
      <span>Update your profile with fresh data from your Reddit account. Last updated {{user.profile.updated}}</span>
      <span class="help">Fetches your subscribed subreddits and reddit profile.</span>
    </div>
  </div>

  <div class="settings-btns">
    <p>Pictures of <a href="{% url 'profile_page' username=user.username %}">{{user.username}}</a></p>
    <div class="item pics-form">
      <form method="POST" action="{% url 'me_picture_page' %}">
        {% csrf_token %}
        <input type="text" name="pic_url" value="" placeholder="http://i.imgur.com/????????.jpg">
        <input type="submit">
      </form>
    </div>
    <div class="item pics-preview">
      {% for pic in request.user.profile.pics %}
      <div class="pic">
        <a href="{{pic.src}}"><img src="{{pic.url}}" alt=""></a>
        <form method="POST" action="{% url 'me_pic_del_page' %}">
          {% csrf_token %}
          <input type="hidden" name="pic_url" value="{{pic.url}}">
          <input type="submit" value="delete">
        </form>
      </div>
      {% endfor %}
    </div>
  </div>

  <div class="settings-btns">
    <p>All about of <a href="{% url 'profile_page' username=user.username %}">{{user.username}}</a></p>
    <form class="item" method="POST" action="{% url 'me_manual_page' %}">
      {% csrf_token %}
      <textarea cols="80" rows="10" name="about" placeholder="Write about yourself. Or about why you like pizza and bacon. Or about that bird you saw that just escaped that cat last year.">{{user.profile.about}}</textarea>
      <p><input type="submit"></p>
    </form>
  </div>

</article>
{% endblock %}