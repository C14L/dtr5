{% extends 'dtr5app/base.html' %}

{% block main %}
<aside id="sidebar">
  <form class="sr-list" method="POST" action="{% url 'me_favsr_page' %}">
    {% csrf_token %}
    <h2>Favorite subreddits</h2>
    {% if user.subs.all %}
    <p>Pick up to 10 subreddits as your favourites.</p>
    <p><input type="submit"></p>
    <ul class="sr-list">
      {% for row in user.subs.all %}
      <li>
        <label>
          <input{% if row.is_favorite %} checked{% endif %} type="checkbox" name="id_{{row.sr.id}}" value="1">
        </label>
        <a href="{% url 'sr_page' row.sr.display_name %}">/r/{{row.sr.display_name}}</a>
        <div class="status">
          {% if row.sr.over_18 %}
          <span class="nsfw-tag">NSFW</span>
          {% endif %}
          {% if 1 == 0 and row.user_is_contributor %}
          <span class="contrib-tag">contributor</span>
          {% endif %}
          {% if row.user_is_moderator %}
          <span class="mod-tag">moderator</span>
          {% endif %}
          {% if 1 == 0 and row.user_is_subscriber %}
          <span class="subscr-tag">subscriber</span>
          {% endif %}
          {% if row.user_is_banned %}
          <span class="banned-tag">banned</span>
          {% endif %}
          {% if row.user_is_muted %}
          <span class="muted-tag">muted</span>
          {% endif %}
        </div>
      </li>
      {% endfor %}
    </ul>
    <p><input type="submit"></p>
    {% else %}
    <p>No subreddits to show.</p>
    {% endif %}
  </form>

</aside>

<article>

  <div class="settings-section section-search">
    <h2>search settings</h2>
    <div class="item">
      <form method="POST" action="{% url 'me_search_page' %}">
        {% csrf_token %}
        <input type="hidden" name="next" value="{% url 'me_page' %}">
        <label>
          <span>find</span>
          <select name="f_sex" size="1">
            <option value="">everybody</option>
            {% for sex in sex_choices %}
              {% if sex.0 > 0 %}
                <option{% if user.profile.f_sex == sex.0 %} selected{% endif %} value="{{sex.0}}">{{sex.1}}</option>
              {% endif %}
            {% endfor %}
          </select>
        </label>
        <label>
          <select name="f_distance" size="1"><!-- in km -->
            <option{% if user.profile.f_distance == 20040 %} selected{% endif %}  value="20040">worldwide</option>
            <option{% if user.profile.f_distance == 300 %} selected{% endif %}  value="300">not too far</option>
            <option{% if user.profile.f_distance == 50 %} selected{% endif %}  value="50">in my area</option>
            <option{% if user.profile.f_distance == 15 %} selected{% endif %} value="15">near by</option>
          </select>
        </label>
        <label class="submit">
          <input type="submit" value="search">
        </label>
      </form>
    </div>
  </div>

  <div class="settings-section section-profile">
    <h2>profile settings</h2>

    <form class="item manual" method="POST" action="{% url 'me_manual_page' %}">
      {% csrf_token %}
      <p>
        <label class="sex">
          <span>my gender:</span>
          <select name="sex" size="1">
            {% for sex in sex_choices %}
            <option {% if user.profile.sex == sex.0 %}selected{% endif %} value="{{sex.0}}">{{sex.1}}</option>
            {% endfor %}
          </select>
        </label>
      </p>
      <p>
        <label class="dob">
          <span>my birthday:</span>
          <input type="date" name="dob" placeholder="YYYY-MM-DD" maxlength="10" value="{{user.profile.dob|date:'c'}}">
          <span class="help">never publicly shown! only used to show your age and zodiacs.</span>
        </label>
      </p>
      <p>
        <label class="submit">
          <input type="submit" value="submit">
        </label>
      </p>
    </form>

    <div class="item">
      <form method="GET" action="{% url 'me_locate_page' %}" onsubmit="geoloc(this);return false;">
        {% csrf_token %}
        <input type="hidden" name="lat" value="">
        <input type="hidden" name="lng" value="">
        <input type="submit" value="locate">
      </form>
      <p>update your geolocation, currently <a href="https://www.google.com/maps/@{{user.profile.lat}},{{user.profile.lng}},11z">lat={{user.profile.lat}} lng={{user.profile.lng}}</a></p>
      <p class="help">your geolocation will randomly be fuzzied around a 1 km radius.</p>
    </div>

    <div class="item">
      <form method="POST" action="{% url 'me_update_page' %}">
        {% csrf_token %}
        <input type="submit" value="update">
      </form>
      <p>update your profile with fresh data from your reddit account. last updated {{user.profile.updated}}</p>
      <p class="help">fetches your subscribed subreddits and reddit profile.</p>
    </div>
  </div>

  <div class="settings-section section-pics">
    <h2>pictures of <a href="{% url 'profile_page' username=user.username %}">{{user.username}}</a></h2>
    <div class="item pics-form">
      <form method="POST" action="{% url 'me_picture_page' %}">
        {% csrf_token %}
        <input type="text" name="pic_url" value="" placeholder="https://imgur.com/??????">
        <input type="submit" value="add picture">
      </form>
    </div>
    <div class="item pics-preview">
      {% for pic in request.user.profile.pics %}
      <div class="pic">
        <a href="{{pic.src}}"><img src="{{pic.url}}" alt=""></a>
        <form method="POST" action="{% url 'me_pic_del_page' %}">
          {% csrf_token %}
          <input type="hidden" name="pic_url" value="{{pic.url}}">
          <input type="submit" value="delete">
        </form>
      </div>
      {% endfor %}
    </div>
  </div>

  <div class="settings-section section-about">
    <h2>about <a href="{% url 'profile_page' username=user.username %}">{{user.username}}</a></h2>
    <form class="item" method="POST" action="{% url 'me_manual_page' %}">
      {% csrf_token %}
      <textarea name="about" placeholder="write about yourself. or about your favorite subreddits. or about why you like pizza and bacon. or about that bird you saw that just escaped that cat last year.">{{user.profile.about}}</textarea>
      <p><input type="submit" value="submit"></p>
    </form>
  </div>

  <div class="settings-section section-account">
    <h2>account settings</h2>
    <ul>
      <li>
        <a href="{% url 'me_nope_page' %}">noped users</a>
        <span class="help"></span>
      </li>
      <li>
        <a href="{% url 'me_flag_del_page' %}">delete all my likes and nopes</a>
        <span class="help"></span>
      </li>
      <li>
        <a href="{% url 'me_account_del_page' %}">delete account data</a>
        <span class="help">deletes most account data, all pictures, 'like' votes, profile content, etc.</span>
      </li>
    </ul>
  </div>

</article>
{% endblock %}